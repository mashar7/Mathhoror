<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Math Battle: Team Humans vs Team Pocong</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        /* Layout dioptimalkan untuk aspek rasio 16:9 (TV 75 inci) */
        #game-container { box-shadow: 0 0 50px rgba(0, 255, 204, 0.4); }
    </style>
</head>
<body>
    <div id="game-container"></div>

    <script>
    class BootScene extends Phaser.Scene {
        constructor() { super('BootScene'); }
        preload() {
            let g = this.make.graphics({x: 0, y: 0, add: false});
            // Arena Luas (1920x1080)
            g.fillStyle(0x0f172a); g.fillRect(0, 0, 1920, 1080); g.generateTexture('bg', 1920, 1080);
            // Tim Manusia (Biru) & Tim Pocong (Putih)
            g.clear(); g.fillStyle(0x2ecc71); g.fillRect(0, 0, 120, 120); g.generateTexture('t1_hero', 120, 120);
            g.clear(); g.fillStyle(0xffffff); g.fillRect(0, 0, 100, 200); g.generateTexture('t2_pocong', 100, 200);
            // Efek Jumpscare & Partikel
            g.clear(); g.fillStyle(0xff0000); g.fillRect(0, 0, 1920, 1080); g.generateTexture('ghost', 1920, 1080);
            g.clear(); g.fillStyle(0xffffff); g.fillCircle(15, 15, 15); g.generateTexture('flare', 30, 30);
            
            this.add.text(960, 540, 'MENYIAPKAN ARENA BATTLE...', { fill: '#00ffcc', font: 'bold 40px Arial' }).setOrigin(0.5);
        }
        create() { this.scene.start('BattleScene'); }
    }

    class BattleScene extends Phaser.Scene {
        constructor() { 
            super('BattleScene'); 
            this.teams = {
                t1: { input: "", ans: 0, hp: 100, isLock: false },
                t2: { input: "", ans: 0, hp: 100, isLock: false }
            };
        }
        
        create() {
            this.add.image(960, 540, 'bg');
            
            // --- POSISI KARAKTER ---
            this.p1 = this.add.sprite(400, 800, 't1_hero');
            this.p2 = this.add.sprite(1520, 800, 't2_pocong');
            this.jump = this.add.image(960, 540, 'ghost').setAlpha(0).setDepth(100);

            // --- HP BARS (Atas) ---
            this.createHPBars();

            // --- PARTICLE EMITTERS ---
            this.emit1 = this.add.particles(0, 0, 'flare', { speed: 300, scale: {start: 1, end: 0}, blendMode: 'ADD', emitting: false });
            this.emit2 = this.add.particles(0, 0, 'flare', { speed: 300, scale: {start: 1, end: 0}, blendMode: 'ADD', emitting: false });

            // --- UI INPUT (Kiri & Kanan) ---
            this.createTeamUI('t1', 480);
            this.createTeamUI('t2', 1440);

            this.newQuest('t1');
            this.newQuest('t2');
        }

        createHPBars() {
            this.barGfx = this.add.graphics();
            this.updateHP();
        }

        updateHP() {
            this.barGfx.clear();
            // Tim 1 HP (Kiri)
            this.barGfx.fillStyle(0x334155); this.barGfx.fillRect(100, 50, 700, 40);
            this.barGfx.fillStyle(0x2ecc71); this.barGfx.fillRect(100, 50, (this.teams.t1.hp / 100) * 700, 40);
            // Tim 2 HP (Kanan)
            this.barGfx.fillStyle(0x334155); this.barGfx.fillRect(1120, 50, 700, 40);
            this.barGfx.fillStyle(0xff4444); this.barGfx.fillRect(1120 + (700 - (this.teams.t2.hp/100)*700), 50, (this.teams.t2.hp / 100) * 700, 40);
        }

        createTeamUI(id, x) {
            let color = (id === 't1') ? '#00ffcc' : '#ff4444';
            this[id+'_soal'] = this.add.text(x, 250, '', { font: 'bold 80px Courier', fill: color }).setOrigin(0.5);
            this[id+'_input'] = this.add.text(x, 380, '', { font: 'bold 100px Courier', fill: '#fff', backgroundColor: '#1e293b', padding: 20, fixedWidth: 400, align: 'center' }).setOrigin(0.5);
            
            // Numpad raksasa untuk layar 75 inci
            const keys = ['1','2','3','4','5','6','7','8','9','DEL','0','ENT'];
            keys.forEach((k, i) => {
                let bx = (x - 160) + (i % 3) * 160;
                let by = 550 + Math.floor(i / 3) * 130;
                let btn = this.add.text(bx, by, k, { font: 'bold 45px Arial', backgroundColor: '#334155', padding: 30, fixedWidth: 140, align: 'center' })
                    .setInteractive({ useHandCursor: true })
                    .on('pointerdown', () => { if(!this.teams[id].isLock) this.handleKey(id, k); });
            });
        }

        handleKey(id, k) {
            if(k === 'DEL') this.teams[id].input = this.teams[id].input.slice(0, -1);
            else if(k === 'ENT') this.checkAns(id);
            else if(this.teams[id].input.length < 4) this.teams[id].input += k;
            this[id+'_input'].setText(this.teams[id].input);
        }

        newQuest(id) {
            this.teams[id].isLock = false;
            let a = Phaser.Math.Between(10, 50), b = Phaser.Math.Between(10, 50);
            this.teams[id].ans = a + b;
            this[id+'_soal'].setText(`${a} + ${b}`);
            this.teams[id].input = ""; 
            this[id+'_input'].setText("");
        }

        checkAns(id) {
            let team = this.teams[id];
            if(team.input === "" || team.isLock) return;
            team.isLock = true;

            if(parseInt(team.input) === team.ans) {
                this.attack(id);
            } else {
                this.cameras.main.shake(200, 0.01);
                this.time.delayedCall(300, () => this.newQuest(id));
            }
        }

        attack(id) {
            let isT1 = (id === 't1');
            let target = isT1 ? this.p2 : this.p1;
            let attacker = isT1 ? this.p1 : this.p2;
            let emitter = isT1 ? this.emit1 : this.emit2;
            let targetTeam = isT1 ? 't2' : 't1';

            this.tweens.add({
                targets: attacker,
                x: isT1 ? 1300 : 600, duration: 250, yoyo: true,
                onStart: () => {
                    emitter.setParticleTint(isT1 ? 0x00ffcc : 0xff4444); //
                    emitter.setPosition(attacker.x, attacker.y);
                    emitter.start();
                },
                onComplete: () => {
                    emitter.stop();
                    this.teams[targetTeam].hp -= 10;
                    this.updateHP();
                    this.cameras.main.shake(300, 0.02);
                    if(this.teams[targetTeam].hp <= 0) this.gameOver(id);
                    else this.newQuest(id);
                }
            });
        }

        gameOver(winnerId) {
            let winText = (winnerId === 't1') ? 'TIM MANUSIA MENANG!' : 'TIM POCONG MENANG!';
            this.add.text(960, 540, winText, { font: 'bold 120px Arial', fill: '#ffff00', backgroundColor: '#000', padding: 50 }).setOrigin(0.5).setDepth(200);
            this.time.delayedCall(3000, () => location.reload());
        }
    }

    const config = {
        type: Phaser.AUTO,
        width: 1920, height: 1080,
        parent: 'game-container',
        scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
        scene: [BootScene, BattleScene]
    };
    new Phaser.Game(config);
    </script>
</body>
</html>
